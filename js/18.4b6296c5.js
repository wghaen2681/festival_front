(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{e10b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"row q-mt-xl q-pt-xl justify-center"},[a("q-table",{ref:"festivalTable",staticStyle:{width:"55vw"},attrs:{title:"節慶資料",data:t.festivals,columns:t.columns,"row-key":"name"},on:{"row-dblclick":t.getFestivalDetail}})],1),a("div",{staticClass:"row q-my-lg justify-center"},[a("q-btn",{attrs:{flat:"",label:"新增節慶",color:"primary"},on:{click:t.addFestival}})],1),t.FestivalDetails.title?a("div",{staticClass:"row q-mb-lg justify-center"},[t._m(0),a("div",{staticClass:"col-12 flex justify-center"},[a("div",{staticClass:"row",staticStyle:{width:"55vw"}},[a("div",{staticClass:"col q-ml-sm q-mr-xl"},[a("img",{staticStyle:{width:"100%"},attrs:{src:t.FestivalDetails.image}})]),a("div",{staticClass:"col",staticStyle:{"font-size":"1.5rem"}},[a("div",{staticClass:"row"},[t._v(t._s(t.FestivalDetails.dateStart)+" ~ "+t._s(t.FestivalDetails.dateEnd))]),a("div",{staticClass:"row"},[t._v(t._s(t.FestivalDetails.title))]),a("div",{staticClass:"row q-my-md",staticStyle:{"font-size":"1rem"}},[t._v("介紹："+t._s(t.FestivalDetails.description))]),a("div",{staticClass:"row q-my-md",staticStyle:{"font-size":"1rem"}},[t._v("資訊："+t._s(t.FestivalDetails.information))]),a("div",{staticClass:"row q-my-md",staticStyle:{"font-size":"1rem"}},[t._v("主辦單位："+t._s(t.FestivalDetails.host))])])])]),a("div",{staticClass:"col-12 q-my-lg text-center"},[a("q-btn",{staticClass:"text-primary",attrs:{flat:""},on:{click:t.editFestival}},[t._v("編輯節慶")])],1)]):t._e(),a("q-dialog",{attrs:{id:"add_festival"},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[a("q-card",{staticClass:"q-pa-md"},[a("q-card-section",{staticClass:"q-pb-none"},[a("div",{staticClass:"text-h6"},[t._v(t._s(t.mode))])]),a("q-card-section",{staticClass:"q-pb-lg"},[a("q-input",{attrs:{label:"節慶標題"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}}),a("q-input",{attrs:{label:"開始日期"},model:{value:t.form.dateStart,callback:function(e){t.$set(t.form,"dateStart",e)},expression:"form.dateStart"}}),a("q-input",{attrs:{label:"結束日期"},model:{value:t.form.dateEnd,callback:function(e){t.$set(t.form,"dateEnd",e)},expression:"form.dateEnd"}}),a("q-input",{attrs:{label:"節慶內容"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),a("q-input",{attrs:{label:"節慶資訊"},model:{value:t.form.information,callback:function(e){t.$set(t.form,"information",e)},expression:"form.information"}}),a("q-input",{attrs:{label:"主辦單位"},model:{value:t.form.host,callback:function(e){t.$set(t.form,"host",e)},expression:"form.host"}})],1),a("q-card-section",[a("img-inputer",{staticStyle:{width:"100%"},attrs:{placeholder:"點擊或拖曳選擇圖片","bottom-text":"點擊或拖曳以修改",size:"large",theme:"dark","img-src":t.form.image},model:{value:t.form.image,callback:function(e){t.$set(t.form,"image",e)},expression:"form.image"}})],1),a("q-card-actions",{staticClass:"justify-around"},["編輯節慶"===t.mode?a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"text-negative",staticStyle:{width:"80px"},attrs:{flat:"",label:"下架"},on:{click:t.resetForm}}):t._e(),(t.mode,t._e()),a("q-btn",{staticClass:"text-dark",staticStyle:{width:"80px"},attrs:{flat:"",label:"取消"},on:{click:t.resetForm}}),a("q-btn",{staticClass:"text-primary",staticStyle:{width:"80px"},attrs:{flat:"",label:"確認"},on:{click:t.submitModal}})],1)],1)],1)],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-12"},[a("hr",{staticClass:"q-mt-none q-mb-xl",staticStyle:{width:"55vw"}})])}],l=(a("e01a"),a("758b")),r={data(){return{columns:[{name:"account",align:"left",label:"開始日期",field:"dateStart",sortable:!0},{name:"name",required:!0,label:"節慶名稱",align:"left",field:"title",sortable:!0},{name:"email",align:"left",label:"主辦",field:"host"}],festivals:[],alert:!1,mode:"",confirm:!1,prompt:!1,address:"",submitDisable:!1,form:{title:"",dateStart:"",dateEnd:"",description:"",information:"",image:null,host:"",_id:""},FestivalDetails:{image:"",dateStart:"",title:"",description:"",information:"",host:"",index:""}}},methods:{addFestival(){this.mode="新增節慶",this.form={title:"",dateStart:"",dateEnd:"",description:"",information:"",host:""},this.alert=!0},editFestival(t){this.mode="編輯節慶",this.form={image:this.FestivalDetails.image,title:this.FestivalDetails.title,dateStart:this.FestivalDetails.dateStart,dateEnd:this.FestivalDetails.dateEnd,description:this.FestivalDetails.description,information:this.FestivalDetails.information,host:this.FestivalDetails.host,index:t},this.alert=!0},resetForm(t){this.submitDisable?t.preventDefault():(this.alert=!1,this.form={title:"",dateStart:"",dateEnd:"",description:"",information:"",host:"",index:"",_id:""})},async submitModal(){this.submitDisable=!0;try{const t=new FormData;for(const e in this.form)t.append(e,this.form[e]);await l["a"].post("/festivals",t,{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}}),this.alert=!1,this.$swal({icon:"success",title:"新增成功"}),this.form={title:"",dateStart:"",dateEnd:"",description:"",information:"",host:""},this.alert=!1}catch(t){this.alert=!1,this.$swal({icon:"error",title:"新增失敗",text:t.response.data.message})}this.submitDisable=!1},async getFestivalDetail(t,e,a){try{const{data:t}=await l["a"].get("/festivals/"+this.festivals[a]._id);t.result.image&&(t.result.image=`https://festivalsweb.herokuapp.com/files/${t.result.image}`),t.result.dateStart=new Date(t.result.dateStart).toLocaleDateString(),t.result.dateEnd=new Date(t.result.dateEnd).toLocaleDateString(),t.result.index=a,this.FestivalDetails=t.result,console.log(this.FestivalDetails)}catch(s){this.$swal({icon:"error",title:"取得指定節慶錯誤",text:s.response.data.message})}}},async mounted(){try{const{data:t}=await l["a"].get("/festivals/all");this.festivals=t.result.map((t=>(t.image&&(t.image=`https://festivalsweb.herokuapp.com/files/${t.image}`),t.dateStart=new Date(t.dateStart).toLocaleDateString(),t)))}catch(t){this.$swal({icon:"error",title:"錯誤",text:"取得節慶失敗"})}}},o=r,n=a("2877"),c=a("eaac"),d=a("9c40"),m=a("24e8"),f=a("f09f"),v=a("a370"),u=a("27f9"),h=a("4b7e"),p=a("7f67"),b=a("eebe"),w=a.n(b),g=Object(n["a"])(o,s,i,!1,null,null,null);e["default"]=g.exports;w()(g,"components",{QTable:c["a"],QBtn:d["a"],QDialog:m["a"],QCard:f["a"],QCardSection:v["a"],QInput:u["a"],QCardActions:h["a"]}),w()(g,"directives",{ClosePopup:p["a"]})}}]);