(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[24],{f68e:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"container",attrs:{id:"cart"}},[e("h4",[t._v("購物車")]),e("div",{staticClass:"row reverse"},[e("div",{staticClass:"col-12 col-md-3 q-mb-xl q-pa-md column justify-between items-center",staticStyle:{height:"200px",border:"1px solid #757575"}},[e("div",{attrs:{id:"alert"}},[t._v("訂購前請務必確認好想購買的商品種類、尺寸、顏色和數量，並且於2日內完成付款。")]),e("div",{staticClass:"text-center"},[t._v("總計金額")]),e("div",{staticClass:"text-center"},[t._v("$"+t._s(t.totalprice))]),e("q-btn",{staticClass:"text-white bg-primary",staticStyle:{width:"100%"},attrs:{flat:"",label:"立即下單"},on:{click:t.checkout}})],1),e("div",{staticClass:"col-md"}),e("div",{staticClass:"col-12 col-md-8"},[t._m(0),t._m(1),e("div",{staticClass:"row"},[e("div",{staticClass:"col"},t._l(t.cart,(function(s,a){return e("div",{key:s._id,ref:"table",refInFor:!0,staticClass:"row"},[e("div",{staticClass:"col q-mr-md",staticStyle:{overflow:"hidden"}},[e("q-img",{staticStyle:{width:"300px",height:"300px"},attrs:{src:s.image}})],1),e("div",{staticClass:"col-7 column justify-between"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-8 column justify-between"},[e("h6",{staticClass:"q-mt-none q-mb-sm"},[t._v(t._s(s.name))]),e("div",{staticClass:"row"},[t._v(t._s(s.description))])]),e("div",{staticClass:"col-4"},[e("div",{staticClass:"text-center"},[t._v("$"+t._s(s.price*s.amount))])])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"row",staticStyle:{height:"50px"}},[e("q-select",{staticClass:"col q-mr-sm",attrs:{label:"尺寸",options:s.size_option,borderless:""},on:{input:function(s){return t.changeSize(a)}},model:{value:s.sizeModel,callback:function(e){t.$set(s,"sizeModel",e)},expression:"item.sizeModel"}}),e("q-select",{staticClass:"col q-mr-sm",attrs:{label:"數量",options:t.option.amount,borderless:""},on:{input:function(s){return t.changeAmount(a)}},model:{value:s.amountModel,callback:function(e){t.$set(s,"amountModel",e)},expression:"item.amountModel"}}),e("q-btn",{staticClass:"col text-grey-7",attrs:{label:"刪除商品",flat:""},on:{click:function(s){return t.delProduct(a)}}})],1)])])]),t._m(2,!0)])})),0)]),t.cart.length?t._e():e("div",{staticClass:"row"},[e("h6",[t._v("您的購物車中似乎沒有任何東西，歡迎前往商店瀏覽我們的最新商品")])]),t.cart.length?t._e():e("div",{staticClass:"row"},[e("div",{staticClass:"col"}),e("div",{staticClass:"col text-center"},[e("q-btn",{staticClass:"text-white bg-primary",attrs:{falt:"",label:"前往商店",to:"/store"}})],1),e("div",{staticClass:"col"})])])])])},i=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-4"}),e("div",{staticClass:"col"}),e("div",{staticClass:"col-5"}),e("div",{staticClass:"col-2"},[e("div",{staticClass:"text-center"},[t._v("金額")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("hr",{staticClass:"q-mb-md"})])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"col-12 q-mt-md"},[e("hr",{staticClass:"q-mb-md"})])}],c=e("ded3"),o=e.n(c),r=(e("13d5"),e("758b")),l={name:"Cart",data(){const t=[];for(let s=1;s<=20;s++)t.push(s);return{cart:[],option:{size:["xs","sm","md","lg","xl"],amount:Object.freeze(t)}}},computed:{totalprice(){return 0===this.cart.length?0:this.cart.reduce(((t,s)=>t+s.amount*s.price),0)}},methods:{async changeSize(t){try{await r["a"].patch("/users/cart/size",{product:this.cart[t]._id,size:this.cart[t].sizeModel},{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}}),console.log("change size yes")}catch(s){console.log(s),this.$swal({icon:"error",title:"錯誤",text:"更改尺寸失敗"})}},async changeAmount(t){try{await r["a"].patch("/users/cart/amount",{product:this.cart[t]._id,amount:this.cart[t].amountModel},{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}})}catch(s){console.log(s),this.$swal({icon:"error",title:"錯誤",text:"更改數量失敗"})}},async delProduct(t){try{await r["a"].patch("/users/cart/amount",{product:this.cart[t]._id,amount:0},{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}}),this.cart.splice(t,1)}catch(s){console.log(s),this.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"})}},async checkout(){try{await r["a"].post("/users/checkout",{},{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}}),this.$swal({icon:"success",title:"成功",text:"成功下單"}),this.$router.push("/order")}catch(t){this.$swal({icon:"error",title:"錯誤",text:"下單失敗"})}}},async mounted(){try{const{data:t}=await r["a"].get("/users/cart",{headers:{authorization:"Bearer "+this.$store.state.user.jwt.token}});this.cart=t.result.map((t=>(t=o()(o()({},t.product),{},{amount:t.amount,size:t.size,size_option:t.size_option}),t.image=`https://festivalsweb.herokuapp.com/files/${t.image}`,t.amountModel=t.amount,t.sizeModel=t.size,t))),console.log(this.cart)}catch(t){this.$swal({icon:"error",title:"錯誤",text:"取得購物車失敗"})}}},n=l,d=e("2877"),u=e("9c40"),h=e("068f"),m=e("ddd8"),v=e("eebe"),p=e.n(v),C=Object(d["a"])(n,a,i,!1,null,null,null);s["default"]=C.exports;p()(C,"components",{QBtn:u["a"],QImg:h["a"],QSelect:m["a"]})}}]);